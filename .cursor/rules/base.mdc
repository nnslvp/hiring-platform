---
alwaysApply: true
---

# ПРАВИЛА РАБОТЫ С ПРОЕКТОМ NOTION UTIL

## БАЗА ДАННЫХ NOTION

- DATABASE_ID: `27c95810-6f37-8024-b175-d15ffe28f383`
- Название: "Вакансии"
- URL: https://www.notion.so/27c958106f378024b175d15ffe28f383

### Существующие поля
- **Name** (title) - название вакансии
- **Status** (status) - "Заполняется", "Готово к публикации", "Опубликовано", "Закрыто"
- **Мой проект** (checkbox) - флаг моего проекта

### Поля для заполнения

Полное описание всех полей, правил извлечения и примеров см. в `filter-fields-basic.md`

## СТРУКТУРА СТРАНИЦ

```
[Название вакансии] (страница записи)
  ├─ Вакансия (child_page) - структурированные данные в bulleted_list_item
  └─ Пост (child_page) - материал для публикации
```

Ключевые блоки в "Вакансия": "Водительские права:", "Прицеп:", "Регионы работы:", "Минимальный опыт работы:", "Свидетельство квалификации (код 95):", "ADR (опасные грузы):", "Оплата:", "Тип договора:", "Карта водителя (для тахографа):"

## РАБОТА С ДАННЫМИ

### Чтение данных
Используются MCP Tools через префикс `mcp_notionApi_*`:
- `mcp_notionApi_API-retrieve-a-database` - информация о базе данных
- `mcp_notionApi_API-post-database-query` - запрос записей
- `mcp_notionApi_API-retrieve-a-page` - информация о странице
- `mcp_notionApi_API-get-block-children` - содержимое страницы (блоки)

Важно:
- `page_size`: максимум 100
- `database_id`: `27c95810-6f37-8024-b175-d15ffe28f383`
- ID можно использовать с дефисами или без

### Обновление данных
Обновление свойств вакансий выполняется **только через скрипт** `update_vacancy_from_json.py`:
```bash
python3 update_vacancy_from_json.py <путь_к_json_файлу>
```

Скрипт читает JSON файл с данными и обновляет указанные поля в Notion через API.

## ФОРМАТ JSON ДЛЯ СКРИПТА ОБНОВЛЕНИЯ

Формат JSON файлов для патчей описан в `.cursor/commands/create-patches.md`

## ПРАВИЛА ОБРАБОТКИ

- Блок не найден → null
- "Не указано" → null
- Диапазон зарплаты → минимальное значение
- Multi_select → все найденные значения
- Select → первое или наиболее подходящее
- Несоответствие опциям → найти ближайшее или null

## КОМАНДЫ ПРОЕКТА

### 1. `/fetch-vacancies` - Получение данных вакансий

Получает ID всех вакансий и содержимое их вложенных документов из базы данных Notion и сохраняет в JSON файл.

**Использование:**
```bash
python3 fetch_vacancies.py [output_file.json]
```

По умолчанию сохраняет данные в `vacancies.json`.

**Процесс:**
1. Получает все ID страниц из базы данных "Вакансии"
2. Обрабатывает пагинацию (максимум 100 записей за запрос)
3. Для каждой вакансии получает все вложенные документы (child_page)
4. Для каждого вложенного документа получает полное содержимое (все блоки)
5. Сохраняет ID основной страницы и содержимое вложенных документов в JSON файл

**Формат выходного файла:**
- Массив объектов, каждый представляет одну вакансию
- `page_id` - ID основной страницы вакансии
- `child_pages` - массив объектов с `page_id` и `content` (чистый текст)

### 2. `/create-patches` - Создание патчей для вакансий

Создает JSON файлы с данными полей для всех вакансий из `vacancies.json` через ИИ.

**ВАЖНО:**
- Файл `vacancies.json` большой (900+ строк, 70+ вакансий)
- Нужно обрабатывать вакансии пачками (батчами), а не все сразу
- Читать файл частями, используя offset и limit при чтении
- Обрабатывать по 5-10 вакансий за раз
- Сохранять прогресс и продолжать с следующей пачки

**Процесс:**
1. Читает `vacancies.json` частями (offset/limit)
2. Для каждой вакансии в пачке анализирует содержимое child_pages
3. Извлекает значения полей согласно правилам из `filter-fields-basic.md`
4. Создает JSON файлы в формате `vacancy-{page_id}.json` в папке `patches/`
5. Продолжает со следующей пачки до обработки всех вакансий

**Формат выходных файлов:**
- `vacancy-{page_id}.json` с полями согласно `filter-fields-basic.md` (12 полей)

### 3. `/apply-patches` - Применение патчей

Применяет все готовые патчи из папки `patches/` используя скрипт `update_vacancy_from_json.py`.

**Использование:**
```bash
python3 apply_patches.py
```

**Процесс:**
1. Находит все JSON файлы в папке `patches/`
2. Для каждого патча вызывает `update_vacancy_from_json.py`
3. Показывает прогресс и статистику применения

**Результат:**
- Показывает количество успешно примененных патчей
- Показывает количество ошибок
- Выводит детали ошибок в конце, если они были

**Важно:**
- Применяются все файлы из папки `patches/`
- Каждый патч обновляет только указанные в нем поля
- Ошибки не останавливают процесс, все патчи будут обработаны
- В конце показывается статистика и детали ошибок

## ВАЖНЫЕ ЗАМЕЧАНИЯ

- Чтение данных: через MCP Tools
- Обновление данных: только через скрипт `update_vacancy_from_json.py`
- Используйте `start_cursor` для пагинации
- Соблюдайте ограничения API
- Для дочерних страниц: `get-block-children` с ID родительской страницы
- Скрипт обновляет только указанные в JSON поля
- Пустые массивы [] очистят multi_select поле
