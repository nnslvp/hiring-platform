"""
Единый файл с константами для всех полей матчинга.
Используется в analyze_candidates.py, process_with_gpt.py и vacancy_matcher.py.
"""

# =============================================================================
# КАТЕГОРИИ ПРАВ (только реальные категории водительского удостоверения)
# =============================================================================
LICENSE_CATEGORIES = ["B", "C", "C1", "CE", "D", "D1"]

# =============================================================================
# СТАТУСЫ ДОКУМЕНТОВ (для профиля кандидата)
# Применяется к: work_permit, code_95, adr, driver_card
# =============================================================================
DOCUMENT_STATUS = ["есть", "в процессе", "нет"]

# =============================================================================
# УРОВЕНЬ ТРЕБОВАНИЙ (для вакансий)
# Применяется к: Код 95, ADR, Карта водителя
# null = не требуется (пустое поле)
# =============================================================================
REQUIREMENT_LEVEL = ["Обязательно", "Желательно"]

# =============================================================================
# ТИП ЭКИПАЖА (единый для кандидата и вакансии)
# "семейный" в переписках = "парный" (два водителя)
# =============================================================================
CREW_TYPE = ["соло", "парный"]

# =============================================================================
# УРОВЕНЬ ПОЛЬСКОГО ЯЗЫКА (для профиля кандидата)
# =============================================================================
POLISH_LEVEL = ["свободный", "базовый", "нет"]

# =============================================================================
# ТРЕБОВАНИЕ ПОЛЬСКОГО ЯЗЫКА (для вакансий)
# null = не требуется
# =============================================================================
POLISH_REQUIREMENT = ["Обязательно", "Желательно"]

# =============================================================================
# ТИП ТЕХНИКИ (для вакансий)
# BDF - это тип техники (система сменных кузовов), НЕ категория прав!
# =============================================================================
VEHICLE_TYPES = [
    "Тент",
    "Реф (рефрижератор)",
    "BDF",
    "Контейнеры",
    "Цистерна",
    "Изотерма",
    "Штора",
    "Самосвал",
    "Тандем",
    "Подконтейнерный прицеп"
]

# =============================================================================
# ТИП ОПЛАТЫ (для вакансий)
# =============================================================================
PAYMENT_TYPE = ["Поденная", "Месячная"]

# =============================================================================
# ВАЛЮТА ЗАРПЛАТЫ (для вакансий)
# =============================================================================
SALARY_CURRENCY = ["PLN", "EUR"]

# =============================================================================
# ТИП ДОГОВОРА (для вакансий)
# =============================================================================
CONTRACT_TYPE = ["UMOWA O PRACĘ", "UMOWA ZLECENIE", "B2B"]

# =============================================================================
# ТИП МАРШРУТОВ (для профиля кандидата)
# "внутренние" = только по Польше, не хочет международку
# "международные" = готов на Европу
# =============================================================================
ROUTE_TYPE = ["внутренние", "международные"]

# =============================================================================
# ФУНКЦИИ ВАЛИДАЦИИ
# =============================================================================

def validate_value(value, allowed_values, field_name):
    """
    Проверяет, что значение входит в список допустимых.
    Возвращает (normalized_value, warning) или (None, error).
    """
    if value is None:
        return None, None
    
    if isinstance(value, list):
        warnings = []
        valid_values = []
        for v in value:
            normalized, warn = validate_value(v, allowed_values, field_name)
            if normalized is not None:
                valid_values.append(normalized)
            if warn:
                warnings.append(warn)
        return valid_values, warnings if warnings else None
    
    # Проверяем точное совпадение
    if value in allowed_values:
        return value, None
    
    # Проверяем без учёта регистра
    value_lower = value.lower() if isinstance(value, str) else value
    for allowed in allowed_values:
        if isinstance(allowed, str) and allowed.lower() == value_lower:
            return allowed, f"Нормализовано '{value}' → '{allowed}' в поле {field_name}"
    
    return None, f"Неожиданное значение '{value}' в поле {field_name}. Допустимые: {allowed_values}"


def normalize_for_comparison(value):
    """Нормализация значения для сравнения (приведение к нижнему регистру)."""
    if not value:
        return None
    return value.lower() if isinstance(value, str) else value


def normalize_vehicle_type(vehicle_type):
    """Нормализация типа техники для сравнения."""
    return normalize_for_comparison(vehicle_type)


def normalize_region(region):
    """Нормализация региона для сравнения."""
    return normalize_for_comparison(region)


def normalize_crew_type(crew_type):
    """Нормализация типа экипажа для сравнения."""
    return normalize_for_comparison(crew_type)

